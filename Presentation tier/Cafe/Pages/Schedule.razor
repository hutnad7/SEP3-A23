@page "/Schedule"
@using Cafe.dto
@using Cafe.Models
@inject NotificationService NotificationService
@inject HttpClient httpClient

@attribute [Authorize("MustBeEntertainer")]



<RadzenScheduler @ref=@Scheduler SlotRender=@OnSlotRender style="height: 768px;" TItem="EventDto" Data=@appointments 
    TextProperty="Name" SelectedIndex="2" StartProperty="Start" EndProperty="End">
    <RadzenDayView />
    <RadzenWeekView />
    <RadzenMonthView />
    <RadzenYearView />
</RadzenScheduler>
@code {
    RadzenScheduler<EventDto> Scheduler;
    Dictionary<DateTime, string> events = new Dictionary<DateTime, string>();
    IList<EventDto> appointments = new List<EventDto>
    {
      /*  new EventDto { Start = DateTime.Today.AddDays(-2), End = DateTime.Today.AddDays(-2), Name = "Birthday"  },
        new EventDto { Start = DateTime.Today.AddDays(-2), End = DateTime.Today.AddDays(-2), Name = "Birthday"  },
        new EventDto { Start = DateTime.Today.AddDays(-2), End = DateTime.Today.AddDays(-2), Name = "Birthday"  },
        new EventDto { Start = DateTime.Today.AddDays(-2), End = DateTime.Today.AddDays(-2), Name = "Birthday"  },*/
     };
    protected async override void OnInitialized()
    {
        Guid id = Guid.Parse("c60f40aa-9028-4036-9c09-192dceb95f73");
     var response = await httpClient.GetAsync("http://localhost:8080/api/events/users"+id);
    if (response.IsSuccessStatusCode)
        {
            ShowSuccessNotification();
        }
        else
        {
            ShowErrorNotification("An error occurred while processing your request.");
        }
        appointments = await response.ReadAsync<List<EventDto>>();
    }
    private void ShowSuccessNotification()
    {
        NotificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Success, Summary = "Event created", Detail = "Success Detail", Duration = 4000 });
    }
    private void ShowErrorNotification(string message)
    {
        NotificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Error, Summary = message, Detail = "Unable to create the event", Duration = 4000 });
    }   
    void OnSlotRender(SchedulerSlotRenderEventArgs args)
    {
        // Highlight today in month view
        if (args.View.Text == "Month" && args.Start.Date == DateTime.Today)
        {
            args.Attributes["style"] = "background: rgba(255,220,40,.2);";
        }

        // Highlight working hours (9-18)
        if ((args.View.Text == "Week" || args.View.Text == "Day") && args.Start.Hour > 8 && args.Start.Hour < 19)
        {
            args.Attributes["style"] = "background: rgba(255,220,40,.2);";
        }
    }

    
}